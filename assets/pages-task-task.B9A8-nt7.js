import{q as e,s as t,v as a,E as l,M as o,u as s,r as n,c as r,J as u,o as i,d as c,w as d,f as m,N as p,j as _,t as f,C as v,g as k,h as g,i as h,F as b,K as y,O as F,k as j,l as x,P as w,x as T,B as C,z as S,_ as I}from"./index-DohrWjOy.js";import{_ as N}from"./uv-tabs.DOvErF9K.js";import{S as $,N as M,_ as E}from"./NotError.kyBwHj9m.js";import{_ as V}from"./uv-button.DH27WfFJ.js";import{s as A}from"./setTabbarText.SGb6PwbV.js";import{u as B}from"./user.Bx_tLptQ.js";import"./uv-line-progress.C81GL_vx.js";import"./date.B8FaB0HV.js";import"./uv-loading-icon.eox0wjZY.js";const D=I(e({__name:"task",setup(e){const I=t({lineColor:"#FF2442",activeStyle:{color:"#FF2442"},inactiveStyle:{color:"#4B5563"},list:[{name:a.t("page.task.1")},{name:a.t("component.order.1"),disabled:!0},{name:a.t("component.order.2"),disabled:!0}],lineWidth:"100",lineHeight:"2",current:0,scrollable:!1}),D=t([{id:1,icon:"../../static/task/praise.png",title:a.t("component.order.3"),teskTitle:a.t("component.order.7"),num:0},{id:2,icon:"../../static/task/forwarding.png",title:a.t("component.order.4"),teskTitle:a.t("component.order.8"),num:0},{id:3,icon:"../../static/task/concern.png",title:a.t("component.order.5"),teskTitle:a.t("component.order.9"),num:0},{id:4,icon:"../../static/task/star.png",title:a.t("component.order.6"),teskTitle:a.t("component.order.10"),num:0}]),J=(e=8)=>{const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return Array.from({length:e}).map((()=>t.charAt(Math.floor(Math.random()*t.length)))).join("")},O=t(Array.from({length:8}).map(((e,t)=>({id:t+1,icon:`/static/task/avatar${t+1}.jpg`,name:J(8)})))),U=B(),q=t([]),P=t([]),W=t({period_number:"",start_time:"",end_time:"",status:"",is_expired:!1,remaining_time:0,like_amount:0,share_amount:0,forward_amount:0,favorite_amount:0}),z=t(""),H=l((()=>(q.value.reduce(((e,t)=>e+({[a.t("component.order.3")]:W.value.like_amount,[a.t("component.order.4")]:W.value.share_amount,[a.t("component.order.5")]:W.value.forward_amount,[a.t("component.order.6")]:W.value.favorite_amount}[t.title]||0)*t.num),0)||0).toFixed(2))),K=({index:e})=>{0===e?I.value.current=e:y({url:"/pages/order/order?type="+e})},L=(e,t)=>{const a=e.value.findIndex((e=>JSON.stringify(e)===JSON.stringify(t)));-1===a?e.value.push(t):e.value.splice(a,1)},G=l((()=>{const e={};return D.value.forEach((t=>{switch(t.id){case 1:e[t.title]="like_count";break;case 2:e[t.title]="share_count";break;case 3:e[t.title]="follow_count";break;case 4:e[t.title]="favorite_count"}})),e})),Q=()=>{var e;const t={amount:Number(H.value),profit_amount:90,like_count:0,share_count:0,follow_count:0,favorite_count:0,period_number:(null==(e=null==W?void 0:W.value)?void 0:e.period_number)??""};q.value.forEach((e=>{const a=G.value[e.title];a&&(t[a]=e.num)})),0!==t.amount?a.service.order$create(t).then((e=>{e.success(((e,t)=>{F({title:t,icon:"none"})}))})):a.showToast(a.t("page.task.8"))},R=()=>{U.user.has_group_buy_qualification&&z.value?a.dialogFun($,{}):a.dialogFun(M,{})},X=t(0);let Y;const Z=e=>{const t=Date.now(),a=new Date(e).getTime(),l=Math.floor((a-t)/1e3);X.value=l>0?l:0,X.value>0&&(Y&&clearInterval(Y),Y=setInterval((()=>{X.value>0?X.value--:(clearInterval(Y),ee())}),1e3))},ee=()=>{try{a.service.order$period({}).then((e=>e.success((e=>{W.value=e,Z(e.end_time)}))))}catch(e){}};return o((()=>{ee(),U.fetchUserInfo(),a.service.groupBuy$activeDetail({}).then((e=>{e.success((e=>{z.value=e.has_data}))}))})),s((()=>{A()})),(e,t)=>{const l=n(r("uv-tabs"),N),o=j,s=x,y=S,F=n(r("uv-number-box"),E),$=n(r("uv-button"),V),M=w,A=u("bt-page");return i(),c(A,{tabbar:"",padding:0},{default:d((()=>[m(o,{class:"task content"},{default:d((()=>[m(o,{class:"head"},{default:d((()=>[m(l,p(I.value,{onClick:K}),null,16)])),_:1}),0==I.value.current?(i(),c(M,{key:0,"scroll-y":"",class:"body body0 animate__animated animate__fadeInLeft"},{default:d((()=>[m(o,{class:"title"},{default:d((()=>[m(o,null,{default:d((()=>[m(s,null,{default:d((()=>[_(f(v(a).t("page.order.3"))+":",1)])),_:1}),W.value.period_number?(i(),c(s,{key:0},{default:d((()=>[_("["+f(W.value.period_number)+"]",1)])),_:1})):k("",!0)])),_:1}),m(o,null,{default:d((()=>[m(s,null,{default:d((()=>[_(f(v(a).t("page.task.3"))+":",1)])),_:1}),m(s,null,{default:d((()=>{return[_(f((e=X.value,`00:${Math.floor(e/60).toString().padStart(2,"0")}:${(e%60).toString().padStart(2,"0")}`)),1)];var e})),_:1})])),_:1})])),_:1}),m(o,{class:"subTitle"},{default:d((()=>[_(f(v(a).t("page.task.4")),1)])),_:1}),m(o,{class:"type"},{default:d((()=>[(i(!0),g(b,null,h(D.value,((e,t)=>(i(),c(o,{class:T(["item",q.value.some((t=>t.id===e.id))?"select":""]),key:t,onClick:t=>{L(q,e)}},{default:d((()=>[m(o,null,{default:d((()=>[m(y,{src:e.icon,mode:"aspectFill"},null,8,["src"])])),_:2},1024),C("p",null,f(e.title),1)])),_:2},1032,["class","onClick"])))),128))])),_:1}),m(o,{class:"avatar"},{default:d((()=>[(i(!0),g(b,null,h(O.value,((e,t)=>(i(),c(o,{class:T(["item",P.value.some((t=>t.id===e.id))?"select":""]),key:t,onClick:t=>{L(P,e)}},{default:d((()=>[m(o,null,{default:d((()=>[m(y,{src:e.icon,mode:"aspectFill"},null,8,["src"])])),_:2},1024),C("p",null,f(e.name),1)])),_:2},1032,["class","onClick"])))),128))])),_:1}),(i(!0),g(b,null,h(q.value,((e,t)=>(i(),c(o,{class:"task-detail",key:t},{default:d((()=>[m(o,{class:"left"},{default:d((()=>[_(f(e.teskTitle),1)])),_:2},1024),m(F,{modelValue:e.num,"onUpdate:modelValue":t=>e.num=t,min:0,integer:"",inputWidth:50},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)))),128)),m(o,{class:"totalPrice"},{default:d((()=>[m(o,{class:"left"},{default:d((()=>[_(f(v(a).t("page.task.5")),1)])),_:1}),m(o,null,{default:d((()=>[_("$ "+f(H.value),1)])),_:1})])),_:1}),m(o,{class:"together"},{default:d((()=>[m($,{text:v(a).t("page.task.6"),color:"#FF0036",onClick:R},null,8,["text"])])),_:1}),m(o,{class:"buy"},{default:d((()=>[m($,{text:v(a).t("page.task.7"),color:"#FF0036",onClick:Q},null,8,["text"])])),_:1})])),_:1})):k("",!0)])),_:1})])),_:1})}}}),[["__scopeId","data-v-62397276"]]);export{D as default};
